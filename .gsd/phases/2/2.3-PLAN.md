---
phase: 2
plan: 3
wave: 3
---

# Plan 2.3: Support CRUD & Endpoints

## Objective
Implement basic Controller logic and Express Routes for interacting with Users, Roles, Puestos, Titulos, and Portales, hooking them into the `UsuarioRepository` (and generic MongoRepositories) and restricting access via previously created RBAC Middlewares.

## Context
- `.gsd/SPEC.md`
- `.gsd/DECISIONS.md`
- `.gsd/ROADMAP.md`

## Tasks

<task type="auto">
  <name>Support Endpoints Development (Portales, Puestos, Titulos)</name>
  <files>
    - api/controllers/GenericController.js
    - api/routes/portales.routes.js
    - api/routes/puestos.routes.js
    - api/routes/titulos.routes.js
    - api/server.js
  </files>
  <action>
    - Since CRUD for `Portal`, `Puesto`, `Titulo` is homogeneous, optionally create a `api/controllers/GenericController.js` returning CRUD functions injecting a specific mongoose Model. Else write a controller per entity.
    - Expose `GET` (`/`) allowing `admin`, `jefe de rrhh`, `staff`.
    - Expose `POST` (`/`), `PUT` (`/:id`), `DELETE` (`/:id` via soft delete) allowing `admin`, `jefe de rrhh`.
    - Apply `auth` and `rbac` middlewares accordingly to the endpoints.
    - Mount the routers into `api/server.js` (e.g. `/api/portales`).
  </action>
  <verify>grep "/api/portales" api/server.js</verify>
  <done>Support endpoints are mapped inside `server.js` and have RBAC constraints.</done>
</task>

<task type="auto">
  <name>User and Role Endpoints Development</name>
  <files>
    - api/controllers/UsuarioController.js
    - api/routes/usuarios.routes.js
    - api/controllers/RolController.js
    - api/routes/roles.routes.js
    - api/server.js
  </files>
  <action>
    - Create `api/controllers/UsuarioController.js` with CRUD (hashing passwords before creating/updating if changed and avoiding broadcasting the password hash back on GET requests).
    - Map `api/routes/usuarios.routes.js` with full restrictions: mostly `admin` and `jefe de rrhh` (if jefe rrhh has permissions, per RFP they have access across the entire app except physical deletes).
    - Do the same for `api/controllers/RolController.js` mapping `GET` requests to allow user forms to populate roles dropdowns.
    - Check role permissions correctly via `auth` and `rbac` middleware.
  </action>
  <verify>grep "/api/usuarios" api/server.js</verify>
  <done>Both Usuario and Rol routes are cleanly documented inside `server.js` matching standard REST API patterns.</done>
</task>

## Success Criteria
- [ ] Users can be listed, created and modified (with automatic password hashing on creation).
- [ ] Support endpoints (Puesto, Titulo, Portal) return array data from MongoDB.
- [ ] Endpoints properly reject requests via `401 Unauthorized` or `403 Forbidden` if missing/invalid permissions from the generated JWT.
