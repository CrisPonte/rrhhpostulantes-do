---
phase: 3
plan: 3
wave: 2
---

# Plan 3.3: File Retrieval & Cleanups

## Objective
Implement endpoints for listing and downloading candidate files, and ensuring full cleanup on hard deletion.

## Context
- `.gsd/SPEC.md`

## Tasks

<task type="auto">
  <name>File Retrieval Endpoints</name>
  <files>
    - api/controllers/PostulanteController.js
    - api/routes/postulantes.routes.js
    - api/services/StorageService.js
  </files>
  <action>
    - Implement `listFiles(id)` in `PostulanteController` using `StorageService` to read the directory content.
    - Implement `downloadFile(id, filename)` using `res.download`.
    - Map routes: `GET /api/postulantes/:id/files` and `GET /api/postulantes/:id/files/:filename`.
  </action>
  <verify>grep "downloadFile" api/controllers/PostulanteController.js</verify>
  <done>Users can list and download applicant documents.</done>
</task>

<task type="auto">
  <name>Hard Delete & Folder Cleanup</name>
  <files>
    - api/controllers/PostulanteController.js
  </files>
  <action>
    - Ensure `admin` hard delete removes the physical folder from the server.
    - Test the `fs.rmSync` or similar logic via the `StorageService`.
  </action>
  <verify>grep "deleteApplicantDirectory" api/controllers/PostulanteController.js</verify>
  <done>Physical folder is deleted along with the database record for admin users.</done>
</task>

## Success Criteria
- [ ] Files can be listed and downloaded via API.
- [ ] Hard delete cleans up the filesystem.
